# Goal
We wish to create a working pull request for El Dr. Gusman's LogicAnalyzer for the pico2-ice.  We have a working branch (new_pico_ice).  The pico-ice and pico2-ice are FPGA development boards that use the RP2040 and RP2350B respectively to control the ICE40UP5K FPGA.  For FPGA projects the RP2040 and RP2350B will act as logic analyzers to help debug FPGA code.  The pico-ice and pico2-ice supply the clock for the FPGA.  We will load the FPGA flash and when the MCU pulls the CRESETN high the FPGA will be automatically programmed from the flash.  There are two cores on the MCUs.  I wish to use core0 for the logic analyzer leaving core1 for the user. Since we cannot know what the other user will program in core1, we would like to leave his GPIO pins as he set them (and he might set them with PIO or CPU) for the logic analyzer capture.  That way the logic analyzer does not interfere with his code.  This method is presently working fine for the pico-ice.  

I wish to start from the new_pico_ice branch, make a new branch called new_pico2_ice and add the absolute minimum changes to it to enable the pico2-ice to work in the same way.  

# Prime Directive
Only make MINIMAL changes.  This makes it easier for a pull request to be accepted.
I am hoping very little needs to be done to the code except for LogicAnalyzer_Board_Settings.h.  I also want to stay in the style as much as I can of the original project.


## Notes for the pico2-ice
The pico2-ice documentation is at: https://pico2-ice.tinyvision.ai/md_getting__started.html   I am including the ICE40UP5K FPGA datasheet converted from pdf to text (Firmware/LogicAnalyzer_V2/FPGA-dS.txt) for you to refer to.
- The RP2350B requires slightly different pico-sdk settings than the RP2350 and especially the RP2040 because it is the 80 pin package of the newer processor.
- Normally we would start the FPGA clock after CDONE is asserted.  Unfortunately, due to a hardware bug on the pico2-ice, the voltage on the MCU input for CDONE is not > V_IH when CDONE is asserted high.  This makes it so the RP2350B cannot read it.  I suggest a work around of just starting the FPGA clock immediately, or if necessary, reading the ADC, and checking if the level is greater than 1.8V.  The pico-ice is close to having this same hardware issue, and so in the new repository, we could implement the same fix for both boards, once it is known to work for the pico2-ice.  


### Pinout for pico2-ice

GPIO4 = PIN_ICE_SI (ICE_SI, RP2350 ➜ FPGA)
GPIO7 = PIN_ICE_SO (ICE_SO, FPGA ➜ RP2350)
GPIO6 = PIN_ICE_SCK (ICE_SCK)
GPIO5 = PIN_ICE_SSN (sysCONFIG SS, active-low)
GPIO31 = PIN_FPGA_CRESETN (CRESET_B, active-low) 
GPIO40 = PIN_FPGA_CDONE (CDONE) 
GPIO21 = PIN_CLOCK (clock to FPGA)
GPIO1/0/9 = LED_R/G/B (active-low)
No external PSRAM (PIN_RAM_SS = -1)

pico2-ice pins to capture data from:
GPIO20-GPIO43

## Build
To change the board, all I should have to do is edit Logic_Analyzer_Build_Settings.cmake with the new board.  For development, let's leave TURBO_MODE as 0.
